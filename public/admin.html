<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Product Management</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>ðŸ›’ Main Sales Portal - Admin</h1>
            <nav>
                <a href="/">Home</a>
                <a href="/admin">Admin</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="admin-section">
            <h2>Product Management</h2>
            
            <div class="admin-actions">
                <button class="btn btn-primary" onclick="showAddProductForm()">Add New Product</button>
            </div>

            <!-- Add/Edit Product Form -->
            <div id="product-form-container" class="form-container" style="display: none;">
                <h3 id="form-title">Add New Product</h3>
                <form id="product-form">
                    <input type="hidden" id="product-id">
                    
                    <div class="form-group">
                        <label for="product-name">Product Name:</label>
                        <input type="text" id="product-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-description">Description:</label>
                        <textarea id="product-description" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-price">Price ($):</label>
                        <input type="number" id="product-price" step="0.01" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-stock">Stock:</label>
                        <input type="number" id="product-stock" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-image">Image (filename):</label>
                        <input type="text" id="product-image" placeholder="e.g., product.jpg">
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Product</button>
                        <button type="button" class="btn btn-secondary" onclick="hideProductForm()">Cancel</button>
                    </div>
                </form>
            </div>

            <!-- Products Table -->
            <div class="table-container">
                <table id="products-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Price</th>
                            <th>Stock</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="products-tbody">
                        <!-- Products will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Main Sales Portal. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Load products
        async function loadProducts() {
            try {
                const response = await fetch('/api/products');
                const products = await response.json();
                displayProducts(products);
            } catch (error) {
                console.error('Error loading products:', error);
                showNotification('Failed to load products', 'error');
            }
        }

        // Display products in table
        function displayProducts(products) {
            const tbody = document.getElementById('products-tbody');
            tbody.innerHTML = '';
            
            if (products.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No products available</td></tr>';
                return;
            }

            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td>${product.description}</td>
                    <td>$${product.price.toFixed(2)}</td>
                    <td>${product.stock}</td>
                    <td class="action-buttons">
                        <button class="btn btn-small btn-secondary" onclick="editProduct(${product.id})">Edit</button>
                        <button class="btn btn-small btn-danger" onclick="deleteProduct(${product.id})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Show add product form
        function showAddProductForm() {
            document.getElementById('form-title').textContent = 'Add New Product';
            document.getElementById('product-form').reset();
            document.getElementById('product-id').value = '';
            document.getElementById('product-form-container').style.display = 'block';
            document.getElementById('product-name').focus();
        }

        // Hide product form
        function hideProductForm() {
            document.getElementById('product-form-container').style.display = 'none';
            document.getElementById('product-form').reset();
        }

        // Edit product
        async function editProduct(id) {
            try {
                const response = await fetch(`/api/products/${id}`);
                const product = await response.json();
                
                document.getElementById('form-title').textContent = 'Edit Product';
                document.getElementById('product-id').value = product.id;
                document.getElementById('product-name').value = product.name;
                document.getElementById('product-description').value = product.description;
                document.getElementById('product-price').value = product.price;
                document.getElementById('product-stock').value = product.stock;
                document.getElementById('product-image').value = product.image;
                
                document.getElementById('product-form-container').style.display = 'block';
                document.getElementById('product-name').focus();
            } catch (error) {
                console.error('Error loading product:', error);
                showNotification('Failed to load product', 'error');
            }
        }

        // Delete product
        async function deleteProduct(id) {
            if (!confirm('Are you sure you want to delete this product?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/products/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showNotification('Product deleted successfully');
                    loadProducts();
                } else {
                    showNotification('Failed to delete product', 'error');
                }
            } catch (error) {
                console.error('Error deleting product:', error);
                showNotification('Failed to delete product', 'error');
            }
        }

        // Handle form submission
        document.getElementById('product-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const productId = document.getElementById('product-id').value;
            const productData = {
                name: document.getElementById('product-name').value,
                description: document.getElementById('product-description').value,
                price: parseFloat(document.getElementById('product-price').value),
                stock: parseInt(document.getElementById('product-stock').value),
                image: document.getElementById('product-image').value || 'default.jpg'
            };
            
            try {
                let response;
                if (productId) {
                    // Update existing product
                    response = await fetch(`/api/products/${productId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(productData)
                    });
                } else {
                    // Create new product
                    response = await fetch('/api/products', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(productData)
                    });
                }
                
                if (response.ok) {
                    showNotification(productId ? 'Product updated successfully' : 'Product added successfully');
                    hideProductForm();
                    loadProducts();
                } else {
                    showNotification('Failed to save product', 'error');
                }
            } catch (error) {
                console.error('Error saving product:', error);
                showNotification('Failed to save product', 'error');
            }
        });

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type === 'error' ? 'notification-error' : ''}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Initialize
        loadProducts();
    </script>
</body>
</html>
