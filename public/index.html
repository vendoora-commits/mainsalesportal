<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Sales Portal - Your E-commerce Store</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>ðŸ›’ Main Sales Portal</h1>
            <nav>
                <a href="/">Home</a>
                <a href="/admin">Admin</a>
                <a href="#" id="cart-link">Cart (<span id="cart-count">0</span>)</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <h2>Welcome to Our Store</h2>
            <p>Discover amazing products at great prices!</p>
        </section>

        <section class="products">
            <h2>Our Products</h2>
            <div id="product-list" class="product-grid">
                <!-- Products will be loaded here -->
            </div>
        </section>

        <!-- Cart Modal -->
        <div id="cart-modal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Shopping Cart</h2>
                <div id="cart-items"></div>
                <div class="cart-total">
                    <h3>Total: $<span id="cart-total">0.00</span></h3>
                    <button class="btn btn-primary" onclick="checkout()">Checkout</button>
                    <button class="btn btn-secondary" onclick="clearCart()">Clear Cart</button>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Main Sales Portal. All rights reserved.</p>
        </div>
    </footer>

    <script>
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        // Load products
        async function loadProducts() {
            try {
                const response = await fetch('/api/products');
                const products = await response.json();
                displayProducts(products);
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('product-list').innerHTML = '<p class="error">Failed to load products</p>';
            }
        }

        // Display products
        function displayProducts(products) {
            const productList = document.getElementById('product-list');
            productList.innerHTML = '';
            
            if (products.length === 0) {
                productList.innerHTML = '<p>No products available</p>';
                return;
            }

            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <div class="product-image">ðŸ“¦</div>
                    <h3>${product.name}</h3>
                    <p class="product-description">${product.description}</p>
                    <p class="product-price">$${product.price.toFixed(2)}</p>
                    <p class="product-stock">In stock: ${product.stock}</p>
                    <button class="btn btn-primary" onclick="addToCart(${product.id})" ${product.stock === 0 ? 'disabled' : ''}>
                        ${product.stock === 0 ? 'Out of Stock' : 'Add to Cart'}
                    </button>
                `;
                productList.appendChild(productCard);
            });
        }

        // Add to cart
        async function addToCart(productId) {
            try {
                const response = await fetch(`/api/products/${productId}`);
                const product = await response.json();
                
                const existingItem = cart.find(item => item.id === productId);
                if (existingItem) {
                    if (existingItem.quantity < product.stock) {
                        existingItem.quantity++;
                    } else {
                        alert('Cannot add more items. Stock limit reached.');
                        return;
                    }
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                
                saveCart();
                updateCartCount();
                showNotification('Product added to cart!');
            } catch (error) {
                console.error('Error adding to cart:', error);
                alert('Failed to add product to cart');
            }
        }

        // Save cart
        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        // Update cart count
        function updateCartCount() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = count;
        }

        // Show cart modal
        document.getElementById('cart-link').addEventListener('click', (e) => {
            e.preventDefault();
            displayCart();
            document.getElementById('cart-modal').style.display = 'block';
        });

        // Close modal
        document.querySelector('.close').addEventListener('click', () => {
            document.getElementById('cart-modal').style.display = 'none';
        });

        // Display cart
        function displayCart() {
            const cartItems = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p>Your cart is empty</p>';
                cartTotal.textContent = '0.00';
                return;
            }
            
            let total = 0;
            cartItems.innerHTML = '';
            
            cart.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <h4>${item.name}</h4>
                        <p>$${item.price.toFixed(2)} x ${item.quantity} = $${itemTotal.toFixed(2)}</p>
                    </div>
                    <div class="cart-item-actions">
                        <button class="btn btn-small" onclick="updateQuantity(${index}, -1)">-</button>
                        <span>${item.quantity}</span>
                        <button class="btn btn-small" onclick="updateQuantity(${index}, 1)">+</button>
                        <button class="btn btn-danger btn-small" onclick="removeFromCart(${index})">Remove</button>
                    </div>
                `;
                cartItems.appendChild(cartItem);
            });
            
            cartTotal.textContent = total.toFixed(2);
        }

        // Update quantity
        function updateQuantity(index, change) {
            cart[index].quantity += change;
            if (cart[index].quantity <= 0) {
                cart.splice(index, 1);
            }
            saveCart();
            updateCartCount();
            displayCart();
        }

        // Remove from cart
        function removeFromCart(index) {
            cart.splice(index, 1);
            saveCart();
            updateCartCount();
            displayCart();
        }

        // Clear cart
        function clearCart() {
            if (confirm('Are you sure you want to clear your cart?')) {
                cart = [];
                saveCart();
                updateCartCount();
                displayCart();
            }
        }

        // Checkout
        function checkout() {
            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            alert(`Checkout successful! Total: $${total.toFixed(2)}\n\nThank you for your purchase!`);
            cart = [];
            saveCart();
            updateCartCount();
            displayCart();
            document.getElementById('cart-modal').style.display = 'none';
        }

        // Show notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('cart-modal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Initialize
        loadProducts();
        updateCartCount();
    </script>
</body>
</html>
